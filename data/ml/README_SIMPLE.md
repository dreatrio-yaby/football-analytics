# ML Training Dataset - –ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ

## üéØ –°—É—Ç—å 

–°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `ml.training_dataset` –≥–¥–µ –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ = –æ–¥–∏–Ω –º–∞—Ç—á —Å –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ –∫–æ–º–∞–Ω–¥ –∏ —Ç–∞—Ä–≥–µ—Ç–∞–º–∏.

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–û–¥–∏–Ω SQL —Ñ–∞–π–ª** `build_training_dataset.sql` –¥–µ–ª–∞–µ—Ç –≤—Å—ë:

1. **–ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ** –∏–∑ `raw.match_stats`
2. **–í—ã—á–∏—Å–ª—è–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫–∏** —á–µ—Ä–µ–∑ ClickHouse window —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞ 3 –∏ 7 –º–∞—Ç—á–µ–π
3. **–°–æ–∑–¥–∞–µ—Ç —Ç–∞—Ä–≥–µ—Ç—ã** –ø—Ä—è–º–æ –≤ –∑–∞–ø—Ä–æ—Å–µ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Ç–æ—Ç–∞–ª—ã, —É–≥–ª–æ–≤—ã–µ, –∫–∞—Ä—Ç–æ—á–∫–∏)
4. **–û–±—ä–µ–¥–∏–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã** –ø—Ä–æ—Å—Ç—ã–º JOIN –ø–æ `is_home = 1/0`
5. **–°–æ–∑–¥–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É** –æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π

## üìä –ß—Ç–æ –ø–æ–ª—É—á–∞–µ–º

**–¢–∞–±–ª–∏—Ü–∞**: `ml.training_dataset`
- **–°—Ç—Ä–æ–∫–∏**: –û–¥–∏–Ω –º–∞—Ç—á (–¥–æ–º–∞—à–Ω—è—è vs –≥–æ—Å—Ç–µ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞)
- **–¢–∞—Ä–≥–µ—Ç—ã**: 12 –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ü–µ–ª–µ–π (—Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Ç–æ—Ç–∞–ª—ã, —É–≥–ª–æ–≤—ã–µ, –∫–∞—Ä—Ç–æ—á–∫–∏)
- **–ü—Ä–∏–∑–Ω–∞–∫–∏**: 40+ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã (—Å—Ä–µ–¥–Ω–∏–µ –∑–∞ 3/7 –º–∞—Ç—á–µ–π + —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)

## üöÄ –ó–∞–ø—É—Å–∫

### GitHub Action (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```bash
# –ü–æ–ª–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
gh workflow run ml-training-dataset.yml -f operation=build

# –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞
gh workflow run ml-training-dataset.yml -f operation=verify
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ SQL
```sql
-- –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ ClickHouse
SOURCE data/ml/sql/build_training_dataset.sql
```

## üìà –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É
SELECT COUNT(*), COUNT(DISTINCT match_id) FROM ml.training_dataset;

-- –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è ML (Python/R)
SELECT * FROM ml.training_dataset 
WHERE match_date >= '2023-01-01'
FORMAT CSV;

-- –ê–Ω–∞–ª–∏–∑ —Ç–∞—Ä–≥–µ—Ç–æ–≤
SELECT 
    AVG(target_total_goals_over_2_5) * 100 as pct_over_2_5,
    AVG(target_match_result = 2) * 100 as pct_home_wins
FROM ml.training_dataset;
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
raw.match_stats ‚Üí window —Ñ—É–Ω–∫—Ü–∏–∏ ‚Üí JOIN –ø–æ is_home ‚Üí ml.training_dataset
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è:**
- ‚úÖ **–û–¥–∏–Ω —Ñ–∞–π–ª** –≤–º–µ—Å—Ç–æ 4 —Å–ª–æ–∂–Ω—ã—Ö
- ‚úÖ **Window —Ñ—É–Ω–∫—Ü–∏–∏** - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏–ª—É ClickHouse
- ‚úÖ **–ü–æ–Ω—è—Ç–Ω–æ** - –≤—Å—è –ª–æ–≥–∏–∫–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ **–ë—ã—Å—Ç—Ä–æ** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã ClickHouse
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ** - –Ω–∏–∫–∞–∫–∏—Ö —Å–ª–æ–∂–Ω—ã—Ö JOIN —Å `!=`

## üéØ –ü—Ä–∏–∑–Ω–∞–∫–∏

**–î–æ–º–∞—à–Ω—è—è –∫–æ–º–∞–Ω–¥–∞**: `home_*`
- –ì–æ–ª—ã, xG, —É–¥–∞—Ä—ã –∑–∞ 3/7 –º–∞—Ç—á–µ–π
- –ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π, —Ç–æ—á–Ω–æ—Å—Ç—å –ø–∞—Å–æ–≤
- –£–≥–ª–æ–≤—ã–µ, —Ñ–æ–ª—ã, –∫–∞—Ä—Ç–æ—á–∫–∏
- –§–æ—Ä–º–∞ –∫–æ–º–∞–Ω–¥—ã (—Å—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)

**–ì–æ—Å—Ç–µ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞**: `away_*`
- –¢–µ –∂–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–ª—è –≥–æ—Å—Ç–µ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã

**–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–µ**: `diff_*`, `ratio_*`
- –†–∞–∑–Ω–æ—Å—Ç–∏ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É –∫–æ–º–∞–Ω–¥–∞–º–∏
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∞—Ç–∞–∫–∏ (–≥–æ–ª—ã/—É–¥–∞—Ä—ã)

## üéØ –¢–∞—Ä–≥–µ—Ç—ã

- `target_match_result` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç (0/1/2)
- `target_total_goals_over_X_5` - —Ç–æ—Ç–∞–ª—ã –≥–æ–ª–æ–≤
- `target_home/away_goals_over_X_5` - –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ç–æ—Ç–∞–ª—ã
- `target_corners_over_9_5` - —É–≥–ª–æ–≤—ã–µ
- `target_cards_over_3_5` - –∫–∞—Ä—Ç–æ—á–∫–∏  
- `target_fouls_over_20_5` - —Ñ–æ–ª—ã

–í—Å—ë –≥–æ—Ç–æ–≤–æ –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è!