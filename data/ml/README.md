# ML Training Dataset –¥–ª—è —Ñ—É—Ç–±–æ–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å —Å–æ–∑–¥–∞–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é –æ–±—É—á–∞—é—â—É—é –≤—ã–±–æ—Ä–∫—É –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –≤ —Ñ—É—Ç–±–æ–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –º–∞—Ç—á–µ–π.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
raw.match_stats ‚Üí ML Feature Engineering ‚Üí ml.training_dataset
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **SQL Scripts** (`/sql/`) - ETL —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–∏
2. **GitHub Action** (`/.github/workflows/ml-training-dataset.yml`) - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞
3. **Documentation** (`/docs/`) - –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏ —Ç–∞—Ä–≥–µ—Ç–æ–≤

## ü§ñ GitHub Action Workflow

### –¢—Ä–∏–≥–≥–µ—Ä—ã
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π**: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00 UTC (–ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ raw –¥–∞–Ω–Ω—ã—Ö)
- **–ü–æ—Å–ª–µ workflow**: –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `ClickHouse Data Sync`
- **–†—É—á–Ω–æ–π**: `workflow_dispatch` —Å –≤—ã–±–æ—Ä–æ–º –æ–ø–µ—Ä–∞—Ü–∏–∏

### –û–ø–µ—Ä–∞—Ü–∏–∏

#### `build_dataset` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
–ü–æ–ª–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–∏:
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ raw –¥–∞–Ω–Ω—ã—Ö
2. –°–æ–∑–¥–∞–Ω–∏–µ ML —Å—Ö–µ–º—ã –∏ —Ç–∞–±–ª–∏—Ü
3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∫–æ–º–∞–Ω–¥ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫–Ω–∞–º
4. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞—Ä–≥–µ—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
5. –°–±–æ—Ä–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å join'–∞–º–∏ –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
6. –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
7. –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

#### `create_ml_tables`
–¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö):
- –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö `ml`
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `training_dataset`

#### `verify_dataset`
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö:
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ–ø—É—Å–∫–∏ –∏ –≤—ã–±—Ä–æ—Å—ã
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∞—Ä–≥–µ—Ç–∞–º –∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º

#### `get_stats`
–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–∞—Ç–∞—Å–µ—Ç—É
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∞—Ä–≥–µ—Ç–æ–≤
- –°—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

#### `cleanup`
–û—á–∏—Å—Ç–∫–∞ ML –¥–∞–Ω–Ω—ã—Ö:
- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö view
- –û—á–∏—Å—Ç–∫–∞ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è
- `match_id`, `match_date`, `home_team_id`, `away_team_id`

### –¢–∞—Ä–≥–µ—Ç—ã (28 —à—Ç—É–∫)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞**: `target_match_result` (0/1/2)
- **–¢–æ—Ç–∞–ª—ã –≥–æ–ª–æ–≤**: `target_total_goals_over_X_5` (X: 0-5)
- **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ç–æ—Ç–∞–ª—ã**: –¥–æ–º–∞—à–Ω–∏–µ/–≥–æ—Å—Ç–µ–≤—ã–µ –≥–æ–ª—ã over 0.5-3.5
- **–£–≥–ª–æ–≤—ã–µ**: `target_corners_over_X_5` (X: 8-12)
- **–ö–∞—Ä—Ç–æ—á–∫–∏**: `target_cards_over_X_5` (X: 2-5)
- **–§–æ–ª—ã**: `target_fouls_over_X_5` (X: 18,20,22,24)

### –ü—Ä–∏–∑–Ω–∞–∫–∏
**–í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞**: 3, 7, 11 –º–∞—Ç—á–µ–π

**–¢–∏–ø—ã –ø—Ä–∏–∑–Ω–∞–∫–æ–≤**:
- `home_team_*` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–æ–º–∞—à–Ω–µ–π –∫–æ–º–∞–Ω–¥—ã
- `away_team_*` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≥–æ—Å—Ç–µ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã  
- `diff_*` - —Ä–∞–∑–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É –∫–æ–º–∞–Ω–¥–∞–º–∏
- `ratio_*` - –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É –∫–æ–º–∞–Ω–¥–∞–º–∏
- –ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å)

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ workflow

```bash
# –ü–æ–ª–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–∏
gh workflow run ml-training-dataset.yml -f operation=build_dataset

# –¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
gh workflow run ml-training-dataset.yml -f operation=create_ml_tables

# –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
gh workflow run ml-training-dataset.yml -f operation=verify_dataset

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
gh workflow run ml-training-dataset.yml -f operation=get_stats

# –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
gh workflow run ml-training-dataset.yml -f operation=cleanup
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. **GitHub Actions** - –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
2. **ClickHouse** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –∏ –¥–∞–Ω–Ω—ã—Ö
3. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã –≤ –∫–æ–Ω—Ü–µ workflow

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### Secrets (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã)
- `CLICKHOUSE_HOST` - —Ö–æ—Å—Ç ClickHouse
- `CLICKHOUSE_USER` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ClickHouse  
- `CLICKHOUSE_PASSWORD` - –ø–∞—Ä–æ–ª—å ClickHouse
- `ACCESS_KEY_ID` - –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞ S3
- `ACCESS_KEY_SECRET` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á S3

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- Workflow `ClickHouse Data Sync` –¥–æ–ª–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–µ—Ä–≤—ã–º
- –¢–∞–±–ª–∏—Ü–∞ `raw.match_stats` –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö
- –ú–∏–Ω–∏–º—É–º 20 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –º–∞—Ç—á–µ–π –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –ù–∞–ª–∏—á–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª—è—Ö
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ —Ç–∞—Ä–≥–µ—Ç–æ–≤ (0/1 –¥–ª—è –±–∏–Ω–∞—Ä–Ω—ã—Ö)
- –í—ã–±—Ä–æ—Å—ã –≤ –ø—Ä–∏–∑–Ω–∞–∫–∞—Ö (–Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —ç–∫—Å—Ç—Ä–µ–º—É–º—ã)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (0-100%)

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –º–∞—Ç—á–µ–π
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∞—Ä–≥–µ—Ç–æ–≤ (% over/under –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä–æ–≥–æ–≤)
- –°—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫–Ω–∞–º
- –ü–æ–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø–µ—Ä–∏–æ–¥–∞–º

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

Workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –û—á–∏—â–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ `ml.training_dataset`
2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ view –¥–ª—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏ —Ç–∞—Ä–≥–µ—Ç–æ–≤
3. –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Å–≤–µ–∂–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
4. –û—á–∏—â–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã

## üêõ Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ raw –¥–∞–Ω–Ω—ã—Ö**:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ `ClickHouse Data Sync`
- –£–±–µ–¥–∏—Ç—å—Å—è –≤ –Ω–∞–ª–∏—á–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ `raw.match_stats`

**–û—à–∏–±–∫–∏ –≤ feature generation**:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –£–±–µ–¥–∏—Ç—å—Å—è –≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –º–∞—Ç—á–µ–π –¥–ª—è –∫–æ–º–∞–Ω–¥

**–ë–æ–ª—å—à–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**:
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
- –†–∞–∑–±–∏—Ç—å ETL –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ —ç—Ç–∞–ø—ã

**–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫
- –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É edge cases

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [`training_dataset_description.md`](docs/training_dataset_description.md) - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª–µ–π
- SQL —Å–∫—Ä–∏–ø—Ç—ã –≤ `/sql/` - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
- GitHub Action logs - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞